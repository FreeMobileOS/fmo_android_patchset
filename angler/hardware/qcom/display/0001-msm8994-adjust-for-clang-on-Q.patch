From 2a4ed0a529cf8b63fd5e631ce3eb220f330a9875 Mon Sep 17 00:00:00 2001
From: Anay Wadhera <anay1018@gmail.com>
Date: Thu, 14 Mar 2019 17:07:30 -0400
Subject: [PATCH 1/2] msm8994: adjust for clang on Q

Change-Id: Iac0f21c5609a048962d0fdf8fe80a71f08ae60a9
Signed-off-by: Satish Patel <tosatishpatel@gmail.com>
---
 msm8994/libcopybit/Android.mk         |  2 -
 msm8994/libgralloc/Android.mk         | 11 ++----
 msm8994/libgralloc/framebuffer.cpp    |  8 ++--
 msm8994/libgralloc/gralloc.cpp        | 54 +++++++++++++--------------
 msm8994/libhdmi/Android.mk            |  5 +--
 msm8994/libhdmi/hdmi.cpp              |  2 +-
 msm8994/libhwcomposer/Android.mk      |  6 +--
 msm8994/libhwcomposer/hwc.cpp         | 26 ++++++-------
 msm8994/libhwcomposer/hwc_mdpcomp.cpp |  2 +-
 msm8994/libhwcomposer/hwc_qclient.cpp |  6 +--
 msm8994/libhwcomposer/hwc_uevents.cpp |  4 +-
 msm8994/libhwcomposer/hwc_utils.cpp   |  4 +-
 msm8994/libmemtrack/memtrack_msm.c    | 20 +++++-----
 msm8994/liboverlay/Android.mk         |  5 +--
 msm8994/liboverlay/overlay.cpp        |  2 +-
 msm8994/liboverlay/overlayMdp.cpp     |  4 +-
 msm8994/libqdutils/Android.mk         | 10 +----
 msm8994/libqservice/Android.mk        |  3 --
 18 files changed, 75 insertions(+), 99 deletions(-)

diff --git a/msm8994/libcopybit/Android.mk b/msm8994/libcopybit/Android.mk
index 7b12310c..ed28ab36 100644
--- a/msm8994/libcopybit/Android.mk
+++ b/msm8994/libcopybit/Android.mk
@@ -21,8 +21,6 @@ LOCAL_COPY_HEADERS            := copybit.h copybit_priv.h c2d2.h
 include $(BUILD_COPY_HEADERS)
 
 include $(CLEAR_VARS)
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
 
 LOCAL_MODULE                  := copybit.$(TARGET_BOARD_PLATFORM)
 LOCAL_MODULE_RELATIVE_PATH    := hw
diff --git a/msm8994/libgralloc/Android.mk b/msm8994/libgralloc/Android.mk
index ac3d4929..6aa0f822 100644
--- a/msm8994/libgralloc/Android.mk
+++ b/msm8994/libgralloc/Android.mk
@@ -15,10 +15,8 @@
 # Gralloc module
 LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
-include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
+include $(CLEAR_VARS)
 
 LOCAL_MODULE                  := gralloc.$(TARGET_BOARD_PLATFORM)
 LOCAL_MODULE_RELATIVE_PATH    := hw
@@ -27,7 +25,7 @@ LOCAL_MODULE_TAGS             := optional
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
 LOCAL_SHARED_LIBRARIES        := $(common_libs) libmemalloc libqdMetaData
 LOCAL_SHARED_LIBRARIES        += libqdutils libGLESv1_CM
-LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdgralloc\"
+LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdgralloc\" -Wno-sign-conversion
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps) $(kernel_deps)
 LOCAL_SRC_FILES               := gpu.cpp gralloc.cpp framebuffer.cpp mapper.cpp
 LOCAL_COPY_HEADERS_TO         := $(common_header_export_path)
@@ -45,14 +43,11 @@ include $(BUILD_SHARED_LIBRARY)
 # MemAlloc Library
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := libmemalloc
 LOCAL_MODULE_TAGS             := optional
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
 LOCAL_SHARED_LIBRARIES        := $(common_libs) libqdutils libdl
-LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdmemalloc\"
+LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdmemalloc\" -Wno-sign-conversion -Wno-unused-value
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps) $(kernel_deps)
 LOCAL_SRC_FILES               := ionalloc.cpp alloc_controller.cpp
 LOCAL_COPY_HEADERS            := alloc_controller.h memalloc.h
diff --git a/msm8994/libgralloc/framebuffer.cpp b/msm8994/libgralloc/framebuffer.cpp
index 6595a5ca..1f327bf4 100644
--- a/msm8994/libgralloc/framebuffer.cpp
+++ b/msm8994/libgralloc/framebuffer.cpp
@@ -43,14 +43,14 @@
 #include <profiler.h>
 
 #define EVEN_OUT(x) if (x & 0x0001) {x--;}
-/** min of int a, b */
+/** min of int a, b
 static inline int min(int a, int b) {
     return (a<b) ? a : b;
-}
-/** max of int a, b */
+}*/
+/** max of int a, b
 static inline int max(int a, int b) {
     return (a>b) ? a : b;
-}
+}*/
 
 enum {
     PAGE_FLIP = 0x00000001,
diff --git a/msm8994/libgralloc/gralloc.cpp b/msm8994/libgralloc/gralloc.cpp
index d467b143..2a2baedf 100644
--- a/msm8994/libgralloc/gralloc.cpp
+++ b/msm8994/libgralloc/gralloc.cpp
@@ -63,42 +63,42 @@ extern int gralloc_perform(struct gralloc_module_t const* module,
 
 // HAL module methods
 static struct hw_module_methods_t gralloc_module_methods = {
-    open: gralloc_device_open
+    .open = gralloc_device_open
 };
 
 // HAL module initialize
 struct private_module_t HAL_MODULE_INFO_SYM = {
-    base: {
-        common: {
-            tag: HARDWARE_MODULE_TAG,
+    .base = {
+        .common = {
+            .tag = HARDWARE_MODULE_TAG,
 #ifdef ADVERTISE_GRALLOC1
-            module_api_version: GRALLOC1_ADAPTER_MODULE_API_VERSION_1_0,
+            .version_major = GRALLOC1_ADAPTER_MODULE_API_VERSION_1_0,
 #else
-            module_api_version: 1,
+            .version_major = 1,
 #endif
-            version_minor: 0,
-            id: GRALLOC_HARDWARE_MODULE_ID,
-            name: "Graphics Memory Allocator Module",
-            author: "The Android Open Source Project",
-            methods: &gralloc_module_methods,
-            dso: 0,
-            reserved: {0},
+            .version_minor = 0,
+            .id = GRALLOC_HARDWARE_MODULE_ID,
+            .name = "Graphics Memory Allocator Module",
+            .author = "The Android Open Source Project",
+            .methods = &gralloc_module_methods,
+            .dso = 0,
+            .reserved = {0},
         },
-        registerBuffer: gralloc_register_buffer,
-        unregisterBuffer: gralloc_unregister_buffer,
-        lock: gralloc_lock,
-        unlock: gralloc_unlock,
-        perform: gralloc_perform,
-        lock_ycbcr: gralloc_lock_ycbcr,
-        validateBufferSize: NULL,
-        getTransportSize: NULL,
+        .registerBuffer = gralloc_register_buffer,
+        .unregisterBuffer = gralloc_unregister_buffer,
+        .lock = gralloc_lock,
+        .unlock = gralloc_unlock,
+        .perform = gralloc_perform,
+        .lock_ycbcr = gralloc_lock_ycbcr,
+        .validateBufferSize = NULL,
+        .getTransportSize = NULL,
     },
-    framebuffer: 0,
-    fbFormat: 0,
-    flags: 0,
-    numBuffers: 0,
-    bufferMask: 0,
-    lock: PTHREAD_MUTEX_INITIALIZER,
+    .framebuffer = 0,
+    .fbFormat = 0,
+    .flags = 0,
+    .numBuffers = 0,
+    .bufferMask = 0,
+    .lock = PTHREAD_MUTEX_INITIALIZER,
 };
 
 // Open Gralloc device
diff --git a/msm8994/libhdmi/Android.mk b/msm8994/libhdmi/Android.mk
index 1aab46d8..fd70f538 100644
--- a/msm8994/libhdmi/Android.mk
+++ b/msm8994/libhdmi/Android.mk
@@ -2,14 +2,11 @@ LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := libhdmi
 LOCAL_MODULE_TAGS             := optional
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
 LOCAL_SHARED_LIBRARIES        := $(common_libs) liboverlay libqdutils
-LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdhdmi\"
+LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdhdmi\" -Wno-float-conversion -Wno-sign-conversion
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps)
 LOCAL_SRC_FILES               := hdmi.cpp
 
diff --git a/msm8994/libhdmi/hdmi.cpp b/msm8994/libhdmi/hdmi.cpp
index 6a91975d..77b4271d 100644
--- a/msm8994/libhdmi/hdmi.cpp
+++ b/msm8994/libhdmi/hdmi.cpp
@@ -741,7 +741,7 @@ int HDMIDisplay::setActiveConfig(int newConfig) {
 // returns false if the xres or yres of the new config do
 // not match the current config
 bool HDMIDisplay::isValidConfigChange(int newConfig) {
-    int newMode = mEDIDModes[newConfig];
+    // int newMode = mEDIDModes[newConfig];
     uint32_t width = 0, height = 0, refresh = 0;
     getAttrForConfig(newConfig, width, height, refresh);
     return ((mXres == width) && (mYres == height)) || mEnableResolutionChange;
diff --git a/msm8994/libhwcomposer/Android.mk b/msm8994/libhwcomposer/Android.mk
index 9ae742d3..c37446d2 100644
--- a/msm8994/libhwcomposer/Android.mk
+++ b/msm8994/libhwcomposer/Android.mk
@@ -2,9 +2,6 @@ LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := hwcomposer.$(TARGET_BOARD_PLATFORM)
 LOCAL_MODULE_RELATIVE_PATH    := hw
 LOCAL_PROPRIETARY_MODULE      := true
@@ -22,7 +19,8 @@ LOCAL_SHARED_LIBRARIES += libskia
 endif #TARGET_USES_QCOM_BSP
 
 LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdhwcomposer\" \
-                                 -std=c++11
+                                 -std=c++11 -Wno-sign-conversion -Wno-float-conversion -Wno-sizeof-array-argument -Wno-pointer-bool-conversion
+
 #Enable Dynamic FPS if PHASE_OFFSET is not set
 ifeq ($(VSYNC_EVENT_PHASE_OFFSET_NS),)
     LOCAL_CFLAGS += -DDYNAMIC_FPS
diff --git a/msm8994/libhwcomposer/hwc.cpp b/msm8994/libhwcomposer/hwc.cpp
index a8a248de..f9817cca 100644
--- a/msm8994/libhwcomposer/hwc.cpp
+++ b/msm8994/libhwcomposer/hwc.cpp
@@ -51,22 +51,22 @@ static int hwc_device_open(const struct hw_module_t* module,
                            struct hw_device_t** device);
 
 static struct hw_module_methods_t hwc_module_methods = {
-    open: hwc_device_open
+    .open = hwc_device_open
 };
 
 static void reset_panel(struct hwc_composer_device_1* dev);
 
 hwc_module_t HAL_MODULE_INFO_SYM = {
-    common: {
-        tag: HARDWARE_MODULE_TAG,
-        version_major: 2,
-        version_minor: 0,
-        id: HWC_HARDWARE_MODULE_ID,
-        name: "Qualcomm Hardware Composer Module",
-        author: "CodeAurora Forum",
-        methods: &hwc_module_methods,
-        dso: 0,
-        reserved: {0},
+    .common = {
+        .tag = HARDWARE_MODULE_TAG,
+        .version_major = 2,
+        .version_minor = 0,
+        .id = HWC_HARDWARE_MODULE_ID,
+        .name = "Qualcomm Hardware Composer Module",
+        .author = "CodeAurora Forum",
+        .methods = &hwc_module_methods,
+        .dso = 0,
+        .reserved = {0},
     }
 };
 
@@ -237,7 +237,7 @@ static void scaleDisplayFrame(hwc_context_t *ctx, int dpy,
     for (size_t i = 0; i < list->numHwLayers; i++) {
         hwc_layer_1_t *layer = &list->hwLayers[i];
         hwc_rect_t& displayFrame = layer->displayFrame;
-        hwc_rect_t sourceCrop = integerizeSourceCrop(layer->sourceCropf);
+//        hwc_rect_t sourceCrop = integerizeSourceCrop(layer->sourceCropf);
         uint32_t layerWidth = displayFrame.right - displayFrame.left;
         uint32_t layerHeight = displayFrame.bottom - displayFrame.top;
         displayFrame.left = (int)(xresRatio * (float)displayFrame.left);
@@ -517,7 +517,7 @@ static int hwc_setPowerMode(struct hwc_composer_device_1* dev, int dpy,
         }
         //Deliberate fall through since there is no explicit power mode for
         //virtual displays.
-    case HWC_DISPLAY_VIRTUAL:
+    [[clang::fallthrough]]; case HWC_DISPLAY_VIRTUAL:
         if(ctx->dpyAttr[HWC_DISPLAY_VIRTUAL].connected) {
             const int dpy = HWC_DISPLAY_VIRTUAL;
             if(mode == HWC_POWER_MODE_OFF and
diff --git a/msm8994/libhwcomposer/hwc_mdpcomp.cpp b/msm8994/libhwcomposer/hwc_mdpcomp.cpp
index 5549d30e..7d7907f7 100644
--- a/msm8994/libhwcomposer/hwc_mdpcomp.cpp
+++ b/msm8994/libhwcomposer/hwc_mdpcomp.cpp
@@ -1181,7 +1181,7 @@ bool MDPComp::cacheBasedComp(hwc_context_t *ctx,
         return false;
     }
 
-    int mdpCount = mCurrentFrame.mdpCount;
+    //int mdpCount = mCurrentFrame.mdpCount;
 
     if(sEnableYUVsplit){
         adjustForSourceSplit(ctx, list);
diff --git a/msm8994/libhwcomposer/hwc_qclient.cpp b/msm8994/libhwcomposer/hwc_qclient.cpp
index 6d05d386..cbc2959f 100644
--- a/msm8994/libhwcomposer/hwc_qclient.cpp
+++ b/msm8994/libhwcomposer/hwc_qclient.cpp
@@ -230,15 +230,15 @@ static void toggleDynamicDebug(hwc_context_t* ctx, const Parcel* inParcel) {
             qhwc::MDPComp::dynamicDebug(enable);
             if (debug_type != IQService::DEBUG_ALL)
                 break;
-        case IQService::DEBUG_VSYNC:
+        FALLTHROUGH_INTENDED; case IQService::DEBUG_VSYNC:
             ctx->vstate.debug = enable;
             if (debug_type != IQService::DEBUG_ALL)
                 break;
-        case IQService::DEBUG_VD:
+        FALLTHROUGH_INTENDED; case IQService::DEBUG_VD:
             HWCVirtualVDS::dynamicDebug(enable);
             if (debug_type != IQService::DEBUG_ALL)
                 break;
-        case IQService::DEBUG_PIPE_LIFECYCLE:
+        FALLTHROUGH_INTENDED; case IQService::DEBUG_PIPE_LIFECYCLE:
             Overlay::debugPipeLifecycle(enable);
             if (debug_type != IQService::DEBUG_ALL)
                 break;
diff --git a/msm8994/libhwcomposer/hwc_uevents.cpp b/msm8994/libhwcomposer/hwc_uevents.cpp
index d1c68a5d..0c85a8db 100644
--- a/msm8994/libhwcomposer/hwc_uevents.cpp
+++ b/msm8994/libhwcomposer/hwc_uevents.cpp
@@ -58,7 +58,7 @@ static bool getPanelResetStatus(hwc_context_t* ctx, const char* strUdata, int le
     const char* iter_str = strUdata;
     if (strcasestr("change@/devices/virtual/graphics/fb0", strUdata)) {
         while(((iter_str - strUdata) <= len) && (*iter_str)) {
-            char* pstr = strstr(iter_str, "PANEL_ALIVE=0");
+            const char* pstr = strstr(iter_str, "PANEL_ALIVE=0");
             if (pstr != NULL) {
                 ALOGI("%s: got change event in fb0 with PANEL_ALIVE=0",
                                                            __FUNCTION__);
@@ -76,7 +76,7 @@ static int getConnectedState(const char* strUdata, int len)
 {
     const char* iter_str = strUdata;
     while(((iter_str - strUdata) <= len) && (*iter_str)) {
-        char* pstr = strstr(iter_str, "SWITCH_STATE=");
+        const char* pstr = strstr(iter_str, "SWITCH_STATE=");
         if (pstr != NULL) {
             return (atoi(pstr + strlen("SWITCH_STATE=")));
         }
diff --git a/msm8994/libhwcomposer/hwc_utils.cpp b/msm8994/libhwcomposer/hwc_utils.cpp
index 436e09b1..852941fd 100644
--- a/msm8994/libhwcomposer/hwc_utils.cpp
+++ b/msm8994/libhwcomposer/hwc_utils.cpp
@@ -1015,7 +1015,7 @@ void setListStats(hwc_context_t *ctx,
     ctx->listStats[dpy].secureRGBCount = 0;
     ctx->listStats[dpy].refreshRateRequest = ctx->dpyAttr[dpy].refreshRate;
     uint32_t refreshRate = 0;
-    qdutils::MDPVersion& mdpHw = qdutils::MDPVersion::getInstance();
+//    qdutils::MDPVersion& mdpHw = qdutils::MDPVersion::getInstance();
 
     ctx->listStats[dpy].mAIVVideoMode = false;
     resetROI(ctx, dpy);
@@ -1199,7 +1199,7 @@ bool isRotationDoable(hwc_context_t *ctx, private_handle_t *hnd) {
     // Rotate layers, if it is not secure display buffer and not
     // for the MDP versions below MDP5
     if((!isSecureDisplayBuffer(hnd) && isRotatorSupportedFormat(hnd) &&
-        !ctx->mMDP.version < qdutils::MDSS_V5)
+        !(ctx->mMDP.version < qdutils::MDSS_V5))
                    || isYuvBuffer(hnd)) {
         return true;
     }
diff --git a/msm8994/libmemtrack/memtrack_msm.c b/msm8994/libmemtrack/memtrack_msm.c
index 2e6adb54..f89674d0 100644
--- a/msm8994/libmemtrack/memtrack_msm.c
+++ b/msm8994/libmemtrack/memtrack_msm.c
@@ -79,17 +79,17 @@ static struct hw_module_methods_t memtrack_module_methods = {
 };
 
 struct memtrack_module HAL_MODULE_INFO_SYM = {
-    common: {
-        tag: HARDWARE_MODULE_TAG,
-        module_api_version: MEMTRACK_MODULE_API_VERSION_0_1,
-        hal_api_version: HARDWARE_HAL_API_VERSION,
-        id: MEMTRACK_HARDWARE_MODULE_ID,
-        name: "MSM Memory Tracker HAL",
-        author: "The Android Open Source Project",
-        methods: &memtrack_module_methods,
+    .common = {
+        .tag = HARDWARE_MODULE_TAG,
+        .module_api_version = MEMTRACK_MODULE_API_VERSION_0_1,
+        .hal_api_version = HARDWARE_HAL_API_VERSION,
+        .id = MEMTRACK_HARDWARE_MODULE_ID,
+        .name = "MSM Memory Tracker HAL",
+        .author = "The Android Open Source Project",
+        .methods = &memtrack_module_methods,
     },
 
-    init: msm_memtrack_init,
-    getMemory: msm_memtrack_get_memory,
+    .init = msm_memtrack_init,
+    .getMemory = msm_memtrack_get_memory,
 };
 
diff --git a/msm8994/liboverlay/Android.mk b/msm8994/liboverlay/Android.mk
index 26a058f2..f1d1285e 100644
--- a/msm8994/liboverlay/Android.mk
+++ b/msm8994/liboverlay/Android.mk
@@ -2,15 +2,12 @@ LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := liboverlay
 LOCAL_MODULE_TAGS             := optional
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
 LOCAL_SHARED_LIBRARIES        := $(common_libs) libqdutils libmemalloc \
                                  libsync libdl
-LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdoverlay\"
+LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdoverlay\" -Wno-sign-conversion
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps)
 LOCAL_SRC_FILES := \
       overlay.cpp \
diff --git a/msm8994/liboverlay/overlay.cpp b/msm8994/liboverlay/overlay.cpp
index a34e5990..24c37511 100644
--- a/msm8994/liboverlay/overlay.cpp
+++ b/msm8994/liboverlay/overlay.cpp
@@ -420,7 +420,7 @@ Overlay* Overlay::getInstance() {
 // Clears any VG pipes allocated to the fb devices
 // Generates a LUT for pipe types.
 int Overlay::initOverlay() {
-    int mdpVersion = qdutils::MDPVersion::getInstance().getMDPVersion();
+//    int mdpVersion = qdutils::MDPVersion::getInstance().getMDPVersion();
     int numPipesXType[OV_MDP_PIPE_ANY] = {0};
     numPipesXType[OV_MDP_PIPE_RGB] =
             qdutils::MDPVersion::getInstance().getRGBPipes();
diff --git a/msm8994/liboverlay/overlayMdp.cpp b/msm8994/liboverlay/overlayMdp.cpp
index 04e66726..68196f1e 100644
--- a/msm8994/liboverlay/overlayMdp.cpp
+++ b/msm8994/liboverlay/overlayMdp.cpp
@@ -27,9 +27,9 @@
 
 using namespace qdutils;
 
-static inline bool isEqual(float f1, float f2) {
+/*static inline bool isEqual(float f1, float f2) {
         return ((int)(f1*100) == (int)(f2*100)) ? true : false;
-}
+}*/
 
 namespace ovutils = overlay::utils;
 namespace overlay {
diff --git a/msm8994/libqdutils/Android.mk b/msm8994/libqdutils/Android.mk
index e9861a08..94f60800 100644
--- a/msm8994/libqdutils/Android.mk
+++ b/msm8994/libqdutils/Android.mk
@@ -2,14 +2,11 @@ LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := libqdutils
 LOCAL_MODULE_TAGS             := optional
 LOCAL_SHARED_LIBRARIES        := $(common_libs) libui libbinder libqservice
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
-LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdutils\"
+LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdutils\" -Wno-sign-conversion -Wno-float-conversion
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps)
 LOCAL_COPY_HEADERS_TO         := $(common_header_export_path)
 LOCAL_COPY_HEADERS            := display_config.h mdp_version.h
@@ -22,9 +19,6 @@ include $(BUILD_SHARED_LIBRARY)
 
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_COPY_HEADERS_TO           := $(common_header_export_path)
 LOCAL_COPY_HEADERS              := qdMetaData.h
 LOCAL_SHARED_LIBRARIES          := liblog libcutils
@@ -32,7 +26,7 @@ LOCAL_C_INCLUDES                := $(common_includes)
 LOCAL_ADDITIONAL_DEPENDENCIES   := $(common_deps)
 LOCAL_SRC_FILES                 := qdMetaData.cpp
 LOCAL_CFLAGS                    := $(common_flags)
-LOCAL_CFLAGS                    += -DLOG_TAG=\"DisplayMetaData\"
+LOCAL_CFLAGS                    += -DLOG_TAG=\"DisplayMetaData\" -Wno-sign-conversion
 LOCAL_MODULE_TAGS               := optional
 LOCAL_MODULE                    := libqdMetaData
 include $(BUILD_SHARED_LIBRARY)
diff --git a/msm8994/libqservice/Android.mk b/msm8994/libqservice/Android.mk
index 9acbd88f..01e6120d 100644
--- a/msm8994/libqservice/Android.mk
+++ b/msm8994/libqservice/Android.mk
@@ -2,9 +2,6 @@ LOCAL_PATH := $(call my-dir)
 include $(LOCAL_PATH)/../common.mk
 include $(CLEAR_VARS)
 
-# b/24171136 many files not compiling with clang/llvm yet
-LOCAL_CLANG := false
-
 LOCAL_MODULE                  := libqservice
 LOCAL_MODULE_TAGS             := optional
 LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
-- 
2.17.1

